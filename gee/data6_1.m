Yraw = [30, 34, 29, 28, 31, 31, 31, 35, 32;
     35, 41, 26, 32, 36, 30, 37, 40, 34;
     37, 38, 33, 40, 42, 32, 41, 39, 39;
     36, 42, 36, 41, 40, 40, 40, 44, 45];
     
Y = [vec(Yraw(:, [1, 4, 7])');
          vec(Yraw(:, [2, 5, 8])');
          vec(Yraw(:, [3, 6, 9])')];
          
Z = [1, 1, 200; % Z without dummies, data problem: it is 250, not 150
     1, 1, 200;
     1, 1, 200;
     1, 1, 225;
     1, 1, 225;
     1, 1, 225;
     1, 1, 250;
     1, 1, 250;
     1, 1, 250;
     1, 1, 275;
     1, 1, 275;
     1, 1, 275;
     1, 0, 200;
     1, 0, 200;
     1, 0, 200;
     1, 0, 225;
     1, 0, 225;
     1, 0, 225;
     1, 0, 250;
     1, 0, 250;
     1, 0, 250;
     1, 0, 275;
     1, 0, 275;
     1, 0, 275;
     1, -1, 200;
     1, -1, 200;
     1, -1, 200;
     1, -1, 225;
     1, -1, 225;
     1, -1, 225;
     1, -1, 250;
     1, -1, 250;
     1, -1, 250;
     1, -1, 275;
     1, -1, 275;
     1, -1, 275];

%Z = [1, 1, 0, 200; % Z with dummies
%     1, 1, 0, 200;
%     1, 1, 0, 200;
%     1, 1, 0, 225;
%     1, 1, 0, 225;
%     1, 1, 0, 225;
%     1, 1, 0, 150;
%     1, 1, 0, 150;
%     1, 1, 0, 150;
%     1, 1, 0, 275;
%     1, 1, 0, 275;
%     1, 1, 0, 275;
%     1, 0, 1, 200;
%     1, 0, 1, 200;
%     1, 0, 1, 200;
%     1, 0, 1, 225;
%     1, 0, 1, 225;
%     1, 0, 1, 225;
%     1, 0, 1, 150;
%     1, 0, 1, 150;
%     1, 0, 1, 150;
%     1, 0, 1, 275;
%     1, 0, 1, 275;
%     1, 0, 1, 275;
%     1, 0, 0, 200;
%     1, 0, 0, 200;
%     1, 0, 0, 200;
%     1, 0, 0, 225;
%     1, 0, 0, 225;
%     1, 0, 0, 225;
%     1, 0, 0, 150;
%     1, 0, 0, 150;
%     1, 0, 0, 150;
%     1, 0, 0, 275;
%     1, 0, 0, 275;
%     1, 0, 0, 275];
s = 12;
t = 3;
b0 = inverse(Z'*Z)*Z'*Y;
bnew = b0;
%bnew = [1, 0, 0]';
bold = ones(length(b0), 1);
epsilon = 10^-6;
iter = 0;

while(max(abs(bnew - bold)) / sum(abs(bold)) > epsilon)
  iter++;
  printf("Iteration %d\n", iter);
  bold = bnew;
  [bnew,sigma2,MVb,EVb,R] = geeNormal(Y,Z,s,t,bnew);
  disp(sum((Y - Z*bnew).^2));
endwhile




